<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.cssl.pojo.dao.HomePage_productDao">
    <!--查特价商品-->
    <select id="findBargains" parameterType="int" resultType="homepage_product">
        SELECT p.`Product_id`   AS "product_id",
               p.`Product_Name` AS "product_name",
               p.P_imgpath      AS "product_imgPath",
               p.P_price        AS "product_price"
        FROM product p
                 INNER JOIN preferentialactivities pre ON p.`Product_id` = pre.`Product_id`
                 INNER JOIN citiesstates c ON c.`cs_id` = p.p_cid
                 INNER JOIN smallplate s ON c.`sp_id` = s.`sp_id`
                 INNER JOIN largeplate l ON s.`lp_id` = l.`lp_id`
        WHERE l.`lp_id` = #{lp_id};
    </select>
    <!--根据所属城市和所属种类(所属城市唯一)-->
    <select id="findPartyingByCity" parameterType="map" resultType="homepage_product">
        SELECT p.`Product_id` AS "product_id",p.`Product_Name` AS "product_name",p.P_imgpath AS
        "product_imgPath",p.P_price AS "product_price"
        FROM product p
        <trim prefix="where" prefixOverrides="AND || OR">
            <if test="P_cid !=null and P_cid !=''">p.P_cid = #{P_cid}</if>
            <if test="Pt_id!=null and Pt_id!=''">and p.Pt_id = #{Pt_id}</if>
        </trim>
        limit 6;
    </select>
    <!--根据所属城市和所属种类(所属城市不唯一)-->
    <select id="findPartyingByCities" parameterType="map" resultType="homepage_product">
        SELECT
        p.`Product_id` AS "product_id",
        p.`Product_Name` AS "product_name",
        p.P_imgpath AS "product_imgPath",
        p.P_price AS "product_price"
        FROM
        product p
        WHERE p.P_cid IN
        <foreach collection="P_cid" item="name" index="index" open="(" close=")" separator=",">
            #{name}
        </foreach>
        AND p.Pt_id = #{Pt_id}
        LIMIT 6 ;
    </select>
    <!--特价商品-->
    <select id="findSellwell" resultType="homepage_product">
        SELECT p.`Product_id`   AS "product_id",
               p.`Product_Name` AS "product_name",
               p.P_imgpath      AS "product_imgPath",
               p.P_price        AS "product_price"
        FROM tourismproducts t
                 INNER JOIN product p ON t.`Product_id` = p.`Product_id`
        ORDER BY purchases_Number LIMIT 2
    </select>
    <!--跟据商品id查商品详情-->
    <select id="findProductDetails" resultType="productdetails" parameterType="Integer">
        SELECT t.*,cd_includes,cd_excluded,cd_description
        FROM tourismproducts t
                 INNER JOIN product p ON t.`Product_id` = p.`Product_id`
                 INNER JOIN `cost_description` cd ON t.`cd_id` = cd.`cd_id`
        WHERE p.`Product_id` = #{Product_id};
    </select>
    <!--跟据商品id查商品-->
    <select id="findByP_id" parameterType="Integer" resultType="homepage_product">
        SELECT p.`Product_id`   AS "product_id",
               p.`Product_Name` AS "product_name",
               p.P_imgpath      AS "product_imgPath",
               p.P_price        AS "product_price"
        FROM product p
        WHERE Product_id = #{Product_id}
    </select>
    <!--添加购物车-->
    <insert id="addShopping" parameterType="product_shopping">
        INSERT INTO productshoppingcart()
        VALUES (DEFAULT, #{p_id}, #{Travel_date}, #{Product_specification}, #{Adult_num}, #{children_num}, #{baby_num},
                #{Discount}, #{Settlement_price}, #{uid}, #{p_imgpath}, #{p_title});
    </insert>
    <!--查xx购物车里的所有商品-->
    <select id="findShoppingByUid" parameterType="Integer" resultType="product_shopping">
        SELECT * FROM productshoppingcart WHERE uid = #{uid} ORDER BY psc_id
    </select>
    <!--删除购物车里的商品-->
    <delete id="delShopping" parameterType="Integer">
        DELETE FROM productshoppingcart WHERE psc_id = #{psc_id}
    </delete>
</mapper>
