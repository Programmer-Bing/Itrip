function logout(){"undefined"!=typeof WB2&&WB2.checkLogin()&&WB2.logout(function(){window.location.replace(accessRoot+"/login/logout")}),"undefined"!=typeof QC&&QC.Login.check()&&QC.Login.signOut(),window.location.replace(accessRoot+"/login/logout")}function login(){window.location.href=accessRoot+"/login/index?redirect_url="+encodeURIComponent(window.location.href)}function refreshHeader(){$.when($.get(webRoot+"/getHeaderDetail?date="+(new Date).getTime())).done(function(a){if(0==a.code){if(a.data.login){$(".js_loginStatus").eq(0).hide();var b=twemoji.parse(a.data.displayName,{size:16});$(".js_loginStatus").eq(1).find("a.display_name").html(b),$(".js_loginStatus").eq(1).show(),$(".js_loginStatus").eq(0).hide()}else $(".js_loginStatus").eq(0).show(),$(".J_hb_qrcode").show();if(a.data.scItemCount>0){$(".js_sc").find("label").text(a.data.scItemCount);var c=!1;if(a.data.promotionCartCount&&a.data.promotionCartCount>0){$(document).find("#promotion-num").html(a.data.promotionCartCount);var d=new Date;(null==getAreaIdCookies("promotionCart")||d.getDate()!=getAreaIdCookies("promotionCart"))&&(c=!0)}c?$(document).find(".prompt-price-warp").show():$(document).find(".prompt-price-warp").hide()}a.data.orderCount>0&&$(".js_myOrder").find("label").text(a.data.orderCount),a.data.favorCount>0&&$(".js_myFavor").find("label").text(a.data.favorCount),a.data.userAccount?(acc=a.data.userAccount,$("#userAccount").val(a.data.userAccount),$(".contactInfo").val(a.data.userPhoneEmail)):($("#userAccount").val(""),$(".contactInfo").val("")),a.data.userId?(userIdStr=a.data.userId,$("#userId").val(a.data.userId)):$("#userId").val(""),$(".money_sw_box_txt").attr("data-id",a.data.currencyId),$(".money_sw_box_txt .sw_syb").text(a.data.currencyCode),curDiscountHander(a.data.currencyId)}})}function curDiscountHander(a){var b=!1;if(location.href.indexOf("order_now")>-1)$(".js_cur_discount").hide(),$(".js_cur_discount").each(function(){var b=Number($(this).attr("data-currencyid"));a==b&&$(this).show()});else{var c=$(".js_cur_discount").parents(".j_cur_content");$(".js_cur_discount").each(function(){var c=Number($(this).attr("data-currencyid")),d=$(this).parents(".j_cur_block");a==c?(d.show(),b=!0):d.hide()}),b?c.show():c.hide()}}$.getScript("//tjs.sjs.sinajs.cn/open/api/js/wb.js?appkey=1474373704");var userIdStr="",acc="";$.cookie("searched","",{path:"/"});var storage={isSupport:function(){return!!window.localStorage}(),set:function(a,b){this.isSupport&&window.localStorage.setItem(a,b)},get:function(a){return this.isSupport?window.localStorage.getItem(a)||"":""}};$(function(){function a(a){var b,c=new RegExp("(^| )"+a+"=([^;]*)(;|$)");return(b=document.cookie.match(c))?unescape(b[2]):null}function b(){var b=a("area");b||(b=2);var c=$(".areaSearchUrl"+b),d=$(".siteTopSearchIpt").attr("placeholder");d||(d=$(c).attr("data-placeholder"),d&&$(".siteTopSearchIpt").attr("placeholder",d))}function c(){var b=$(".siteTopSearchIpt").val(),c=a("area");c||(c=2);var d=$(".areaSearchUrl"+c),e=$(d).val(),f=$(".siteTopSearchIpt").attr("placeholder");""==b&&"目的地/景点/门票/跟团游"!=f&&window.open(e),$.cookie("cf",0,{path:"/"}),$.cookie("pr",0,{path:"/"}),$.cookie("nw",0,{path:"/"}),$.cookie("sl",0,{path:"/"}),g(b),b&&""!=$.trim(b)&&$("#searchForm").submit()}function d(){var a=new Date;a.setTime(a.getTime()+864e5),document.cookie="cnBanner=1; domain=.itrip.com; path=/; expires="+a.toGMTString()}function e(a){var b=$(a).find("dl dd").length,c=110*b,d=c/2-35;$(a).find("dl").width(c),$(a).find("dl").css("left",-d)}function f(a,b){var c=a.eq(b);c.addClass("active").siblings("li").removeClass("active"),$("#searchForm .siteTopSearchIpt").val(c.text())}function g(a){var b=storage.get("searched");if(b){var c=b.split(",");c.push(a),c=h(c.reverse()),a=c.slice(0,10).reverse().join(",")}storage.set("searched",a)}function h(a){for(var b,c=[],d={},e=0;null!=(b=a[e]);e++)d[b]||(""!=b&&c.push(b),d[b]=!0);return c}function i(a,b){$.trim(a)?$.getJSON(webRoot+"/search/completion?kw="+a,function(a){b(a.data||[])}):b([])}function j(a,b,c){var d;return function(){var e=this,f=arguments,g=function(){d=null,c||a.apply(e,f)},h=c&&!d;clearTimeout(d),d=setTimeout(g,b),h&&a.apply(e,f)}}if(refreshHeader(),$("#top-tips").delegate("a.close","click",function(){$("#top-tips").remove()}),!$(".index_home").val()&&(window.areaId=window.areaId||"",""!=areaId)){var k=new Date;k.setTime(k.getTime()+31536e6),document.cookie="area="+areaId+";path=/;domain=.itrip.com;expires="+k.toGMTString()}if(a("area")){var l=new Date;l.getDate()!=a("hd818")&&($(".hd-guide").removeClass("hide"),l.setTime(l.getTime()+31536e6),document.cookie="hd818="+(new Date).getDate()+";path=/;domain=.itrip.com;expires="+l.toGMTString())}$(".hd-guide .close").click(function(){$(this).parents(".hd-guide").remove()}),$(".promotion-close").click(function(){$(this).parents(".prompt-price-warp").hide();var a=new Date;return a.setTime(a.getTime()+31536e6),document.cookie="promotionCart="+(new Date).getDate()+";path=/;domain=.itrip.com;expires="+a.toGMTString(),!1}),b(),$(".searchBtn").click(function(){c(),"function"==typeof fbq&&fbq("track","Search")}),$(".siteTopSearchIpt").keypress(function(a){13==a.keyCode&&c()}),$(".pageHeader .siteTopSearch").mouseenter(function(){$(this).addClass("siteTopSearchHover"),$(this).find("i.icon_grey_search").removeClass("icon_grey_search").addClass("icon_search")}).mouseleave(function(){$(this).removeClass("siteTopSearchHover"),$(this).find("i.icon_search").removeClass("icon_search").addClass("icon_grey_search")}),$(".pageHeader .siteTopSearchIpt").focus(function(){$(this).addClass("focus")}).blur(function(){$(this).removeClass("focus")}),$(".siteTopSelect").mouseenter(function(){$(this).css("height","auto"),$(this).find("ul").removeClass("hide")}).mouseleave(function(){$(this).find("ul").addClass("hide")}),$(".siteTopSelect ul li").click(function(){$(this).closest("ul").addClass("hide")}),$(".money_sw_box").mouseenter(function(){$(this).find(".money_sw").stop().show().animate({opacity:1})}).mouseleave(function(){$(this).find(".money_sw").stop().hide().css({opacity:0})}),$(".money_sw a").click(function(){$(this).closest(".money_sw_box").find(".money_sw_box_txt .sw_syb").text($(this).find(".sw_syb").text()),$(this).closest(".money_sw").hide();var a=$(this).attr("data-id"),b=new Date;b.setTime(b.getTime()+31536e6),document.cookie="cid="+a+"; domain=.itrip.com; path=/; expires="+b.toGMTString()}),$(".rightBarBot .linkTop").click(function(){$("html,body").stop(!0,!0).animate({scrollTop:0},600)}),$(".sw_syb").hover(function(){$(this).find(".down_list").fadeIn()},function(){$(this).find(".down_list").fadeOut()}),$(".topad .closeAD").on("click",function(){$(this).closest(".topad").remove(),$(this).remove(),0==$(".index_home").length&&d()}),0==$(".index_home").length?a("cnBanner")?$(".topad").is(":visible")&&$(".topad").slideUp("slow"):$(".topad").is(":hidden")&&$(".topad").slideDown("slow"):$(".topad").slideDown("slow"),$(".loadingChose .close").click(function(){$(this).parents(".loadingChose").remove(),$(".hint").removeClass("hide"),$(".isee").click(function(){$(".hint").remove(),$(".loadingFrame").remove(),setPromotionInfo(2)})}),$("iframe[name='google_conversion_frame']").hide();var m,n=[];$(".mainNav ul li").each(function(a){n[a]=-$(".mainNav ul li").eq(a).width()}),$(".mainNav ul li.haschild").hover(function(){$(this).parents(".mainNav").find(".back_b").stop(!0,!0).show(),$(this).find("dl").stop(!0,!0).show(),$(this).addClass("cur").siblings("li").removeClass("cur"),$(this).find("i.gif").css("right","-18px"),m=$(".mainNav ul li.haschild.cur");$(this).index();e(this)},function(){$(".mainNav ul li.haschild").removeClass("cur"),$(this).parents(".mainNav").find(".back_b").stop(!0,!0).hide(),$(this).find("dl").stop(!0,!0).hide(),$(this).find("i.gif").css("right","-20px")}),$(".back_b").hover(function(){m.find("dl").show(),m.addClass("cur"),m.find("i.gif").css("right","-18px"),$(this).stop(!0,!0).show()},function(){m.removeClass("cur"),$(".mainNav ul li.haschild").find("dl").hide(),m.find("i.gif").css("right","-20px"),$(this).stop(!0,!0).hide()}),"1"==$(".index_home").val()?$(".dis-enter-link").removeClass("hide"):$(".dis-enter-link").addClass("hide");var o=$("#searchComponent"),p="",q=-1;$("#searchForm .siteTopSearchIpt").on("focus",function(){var a=decodeURIComponent(storage.get("searched")||""),b=$("#searchComponent");if(a){var c='<li class="title"><span>最近搜过</span><span class="fr deleteHistoryRecord"><i class="iconfont">&#xe643;</i>清空全部</span></li>',a=a.split(",").reverse();a=h(a).slice(0,10),$.each(a,function(){this&&(p=c=c+'<li class="link"><a href="javascript:void(0);">'+this+"</a></li>")}),b.html(c)}else p="";b.removeClass("hide")}).on("blur",function(){setTimeout(function(){o.children(".link").removeClass("active"),o.addClass("hide")},200)}).on("input propertychange",j(function(a){var b=a.target.value+"",c="",d=decodeURIComponent(storage.get("searched")||"");b.length<20&&i(b,function(a){$.each(a,function(){c=c+'<li class="link"><a href="javascript:void(0);">'+this+"</a></li>"}),o.html(b?c:d?p:""),o.removeClass("hide")})},100)).on("keydown",function(a){var b=$("#searchComponent .link");if(b.length>0)switch(a.keyCode){case 38:0>=q?q=b.length-1:q--,f(b,q);break;case 40:q>=b.length-1?q=0:q++,f(b,q)}}),$("#searchForm").on("click",".deleteHistoryRecord",function(){storage.set("searched",""),o.html("")}),$("#searchForm").on("click",".link a",function(){var a=$(this).text();$("#searchForm .siteTopSearchIpt").val(a),setTimeout(function(){c()},30)});var r={init:function(){this.bind()},bind:function(){$(".appdownload .verify img").click(function(){$(this).attr("src","/main/verifyCode?t="+(new Date).getTime())}),$(".appdownload .validate_btn").click(function(){r.getSmsCode(this)}),$(".appdownload .register_sub").click(function(){r.register(this)})},getSmsCode:function(a){r.Time=60;var a=$(a),b=$(".phoneVal").val().trim(),c=$(".verfiycode").val().trim(),d=$("#select1").val();if(""==b)return void $(".error").html("请填写手机号!");if(""==c)return void $(".error").html("请填写图形码!");if("86"==d&&11!=b.length)return void $(".error").html("请填写正确手机号!");var e="/coupon/sendSmsCode?phoneRegionCode="+d+"&phoneNum="+b+"&verifyCode="+c;$.post(e,function(b){0==b.code?($(".error").html("发送成功,快查看手机!"),a.attr("disabled","disabled"),a.val(r.Time+"秒以后获取"),r.cuntDowm(a)):$(".error").html(b.msg)})},cuntDowm:function(a){var b=setInterval(function(){newTimeVal=--r.Time,a.val(newTimeVal+"秒以后获取"),0==newTimeVal&&(clearInterval(b),a.val("重新获取").removeAttr("disabled"),r.Time=60)},1e3)},register:function(a){var a=$(a),b=$(".phoneVal").val().trim(),c=$(".validate_val").val().trim(),d=$("#select1").val(),e=$.cookie("channelId");if(""==b)return void $(".error").html("请填写手机号!");if(""==c)return void $(".error").html("请填写短信验证码!");if("86"==d&&11!=b.length)return void $(".error").html("请填写正确手机号!");$(".appdownload .verify img").attr("src","/main/verifyCode?t="+(new Date).getTime());var f="/coupon/newUser?phoneRegionCode="+d+"&phoneNum="+b+"&smsCode="+c+"&lv="+e;$.post(f,function(a){0==a.code?($(".error").html("领取成功!"),tprm="tailid="+(new Date).getTime()+"&phone="+b+"&userid="+$.cookie("uin")+"&regtype=mianzhuce","function"==typeof __ozfac2&&__ozfac2(tprm,"#pclinghb")):$(".error").html(a.msg)})}};r.init()});